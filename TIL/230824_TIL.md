# 그것이 알고Swift다(2) - 동시성 프로그래밍</br>

<img src = "https://github.com/devKobe24/images/blob/main/%E1%84%80%E1%85%B3%E1%84%80%E1%85%A5%E1%86%BA%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%80%E1%85%A9%E1%84%89%E1%85%B1%E1%86%B8%E1%84%83%E1%85%A1.jpeg?raw=true"></br>

**✅ 동시성 프로그래밍이란 영어로는 `Concurrency Programming`이라고 하며, 멀티 스레드 완경에서 여러 가지 작업을 동시에 처리하는 기술을 말합니다.**</br>

---

## 코어와 스레드</br>

## 1️⃣ 코어</br>

**코어는 CPU의 핵심으로 CPU에서 실제로 일을 처리합니다.**</br>

그러므로 빠르고 효율적인 코어는 성능이 좋은 컴퓨터의 필요조건이라고 할 수 있습니다.</br>

**코어는 `한 번에 한 가지` 일만 처리할 수 있습니다.</br>- 따라서 코어가 여러 개아면 일을 동시에 처이할 수 있는 것입니다.**</br>

**컴퓨터가 일을하는 방법은 사람과 비슷하게 일을 합니다.**</br>

**여러 작업을 동시에 처리하는 것이 아닙니다.**</br>

**✅ 동시에 여러 작업을 한 번에 처리하는 것 처럼 보일 뿐입니다.**</br>

**✅ 사실은 일을 짧은 단위로 나누어서 하나씩 번갈아가면서 일을 처리합니다.</br> - 결국은 `한 번에 한 가지 일은 하는 것입니다.`**</br>

이렇게 여러 가지 작업을 **🕐 시분할로 나누어 번갈아가며 처리하는 것을 `동시성 프로그래밍` 이라고 합니다.**</br>

### Q. 코어가 많으면 무조건 더 빠를까?</br>

**👨‍🔬 A. 꼭 그렇지는 않지만 그럴 가능성이 높습니다.**
- 첫 번째로 요즘 컴퓨터에서는 보기 드문 문제이긴 하지만 코어가 여러 개라면 어떤 코어가 어떤 일을 할지 분배해야 합니다
    - 이를 분배하는 과정에서 약간의 딜레이가 발생하여 싱글 코어보다 작업 속도가 느린 경우가 있을 수있습니다.
    - 사람이 2명이지만 누가 어떤 일을 할지 빠르게 정하지 않으면 한 사람보다 효율이 더 낮을 수 있는 것 처럼 말입니다.
- 두 번째로 소프트웨어 중에 싱글 코어에만 최적화가 된 소프트웨어도 있을 수 있습니다.
    - 이 경우에는 아무리 코어의 갯수가 많더라도 결국 하나의 코어에서만 일을 처리하기 때문에 더 빠르다고 할 수는 없습니다.

---

## 2️⃣ 스레드</br>

**🙌 스레드는 `하드웨어에서의 스레드`와 `소프트웨어에서의 스레드`로 구분이 됩니다.</br>- 같은 용어이지만 의미가 다릅니다.**</br>

**1️⃣ 하드웨어에서의 스레드:</br>- 하이퍼스레딩 기술을 이용하여 하나의 코어로 2가지 작업을 동시에 수행할 수 있도록 하는 `논리적인 '코어'`라고 할 수 있습니다.</br>- 1코어 2스레드라면 실제로 코어는 1개이지만 `코어가 2개인 것처럼` 작업을 처리하게 됩니다.**</br>

**2️⃣ 소프트웨어에서의 스레드:</br>- `논리적인 스레드`로 프로세스(프로그램) 내부에서의 작업 단위가 되는 `가상의 스레드`입니다.</br>- 여기에서 스레드는 프로그램의 작업을 처리하는 녀석들을 말합니다.</br>- 경우에 따라서 스레드는 하나일 수도, 여러 개(멀티 스레드)가 있을 수도 있습니다.</br>- 하나의 스레드가 모든 작업을 처리하는 것보다 여러 개의 스레드에 분산 시켜 작업을 처리하는 것이 효율적일 수 있습니다.**</br>

---

### 살짝 맛보기 🥴</br>

**💡 동시성 프로그래밍이란 `소프트웨어에서의 멀티 스레딩`을 이용한 기술입니다.**
- **즉 여러 스레드를 이용하여 작업을 동시에 처리하는 것입니다.**</br>

**💡 소프트웨어에서의 스레드는 가상으로 만들어진 스레드이기 때문에 물리적인 스레드 갯수와는 상관 없이 많은 스레드를 만들 수 있습니다.**

---

## 동시성 프로그래밍과 병렬 프로그래밍</br>

동시성 프로그래밍과 병렬 프로그래밍의 차이점에 대해서 알아봅시다.

---

## 1️⃣ 병렬 프로그래밍</br>

**✅ 병렬 프로그래밍은 `여러 개의 CPU(코어)가 하나의 작업(Task)을 분담해서` 처리하는 것 입니다.**</br>

만약 아주 큰 영상 혹은 그래픽을 처리해야한다고 했을 때 여러 개의 CPU(코어)가 이미지를 분할하여 담당한다면 좀 더 빠르게 작업을 처리할 수 있겠지요?</br>

예를 들어 하나의 그림을 그리는데 5명의 밥 로스 아저씨가 그림을 5분할하여 각 담당별로 그림을 그린다고 상상해보세요!!</br>

그림이 정말 빠르게 그려질것 같지 않나요?</br>

"참 쉽죠~?!"</br>

<img src = "https://github.com/devKobe24/images/blob/main/%E1%84%87%E1%85%A1%E1%86%B8%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3.jpeg?raw=true" width  = 125><img src = "https://github.com/devKobe24/images/blob/main/%E1%84%87%E1%85%A1%E1%86%B8%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3.jpeg?raw=true" width  = 125><img src = "https://github.com/devKobe24/images/blob/main/%E1%84%87%E1%85%A1%E1%86%B8%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3.jpeg?raw=true" width  = 125><img src = "https://github.com/devKobe24/images/blob/main/%E1%84%87%E1%85%A1%E1%86%B8%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3.jpeg?raw=true" width  = 125><img src = "https://github.com/devKobe24/images/blob/main/%E1%84%87%E1%85%A1%E1%86%B8%E1%84%85%E1%85%A9%E1%84%89%E1%85%B3.jpeg?raw=true" width  = 125></br>

실제로 많은 연산이 필요한 그래픽 처리나 머신 러닝에서는 이 병렬 프로그래밍이 적극적으로 사용되곤 합니다.</br>

다른 재미있는 예시를 들어볼까요?</br>

하나의 레스토랑에서 파스타 주문이 들어왔을 때, 최고의 세프 3명(고든렘지, 제프, 상디)이 각각 면을 삶고, 소스를 만들고, 플레이팅을 `동시에` 진행한다고 생각해보세요!!

<img src = "https://github.com/devKobe24/images/blob/main/%E1%84%80%E1%85%A9%E1%84%83%E1%85%B3%E1%86%AB%E1%84%85%E1%85%A6%E1%86%B7%E1%84%8C%E1%85%B5%E1%84%89%E1%85%A6%E1%84%91%E1%85%B3.jpeg?raw=true" width = 230 height = 135><img src = "https://github.com/devKobe24/images/blob/main/%E1%84%87%E1%85%AE%E1%86%B0%E1%84%8B%E1%85%B3%E1%86%AB%E1%84%87%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%B4%E1%84%8C%E1%85%A6%E1%84%91%E1%85%B3%E1%84%89%E1%85%A6%E1%84%91%E1%85%B3.jpeg?raw=true" width = 230 height = 135><img src = "https://github.com/devKobe24/images/blob/main/%E1%84%89%E1%85%A1%E1%86%BC%E1%84%83%E1%85%B5%E1%84%89%E1%85%A6%E1%84%91%E1%85%B3.jpeg?raw=true" width = 230 height = 135>

**파스타 만들기라는 하나의 작업(Task)** 을 여러 개의 CPU(여기서는 셰프)가 분담해서 처리하는 것입니다.</br>

혼자서 순서대로 작업을 처리하는 것보다 더 빠른 효율을 낼 가능성이 높습니다!</br>

**💡그래서 병렬 프로그래밍은 `물리적인 개념`으로 CPU(코어)가 여러 개 있을 때에 가능합니다.💡**</br>
- 싱글 코어에서는 병렬 프로그래밍을 할 수가 없습니다.
    - **🙌 그 이유는 병렬 프로그래밍은 `실제로 동시에` 작업을 처리하는 것이기 때문입니다.**</br>

병렬 프로그래밍은 iOS를 개발하면서는 직접 구현할 일은 없을 것입니다.</br>그러나 동시성 프로그래밍과 비교하며 개념만 알아두시면 됩니다.</br>운영체제에서 알아서 처리해주는 영역이기 때문입니다.

## 2️⃣ 동시성 프로그래밍</br>

**✅ 동시성 프로그래밍은 하나의 CPU가 여러 작업을 동시에 처리하는 것입니다.**</br>

**✅ 동시성 프로그래밍은 병렬 프로그래밍과 달리 싱글 코어에서도 가능한 `논리적인 개념`입니다.**</br>
- **🙌 물리적으로는 하나의 작업만 처리하는 환경(코어가 하나)에서 논리적으로 여러 일을 동시에 처리하기 때문입니다.**</br>

**✅ 동시성 프로그래밍은 `여러 개의 스레드를 이용하여 동시에 여러 작업을 처리합니다.`**</br>

여기서 다시 재미있는 예시로 설명해보겠습니다!!</br>

위에서 설명한 적이 있는 셰프 이야기 기억하시나요?? 이번에는 1명의 셰프가 일을 합니다!!</br>

**동시성 프로그래밍은** 고든 렘지 셰프, 1명이 동시에 파스타, 스테이크, 라자냐를 만드는 것과 같습니다.</br>

상상해 볼까요??</br>

헬스 키친이라는 프로그램에서 과연 고든 렘지 세프는 이런 상황에서 어떻게 할까요??</br>

**1번 요리 시작 -> 1번 요리 완성 -> 2번 요리 시작 -> 2번 요리 완성 -> ... -> 7번 오리 완성** 이런 방법으로 절대 하지 않아요 아마 그렇게 하는 참가자를 보게 된다면 고든 램지 셰프는 🤬🤬🤬🤬🤬🤬🤬🤬 이럴거에요.</br>

고든 렘지 셰프라면 **여러 가지 작업을 나열해두고 하나씩, 그리고 조금씩 번갈아가면서 작업을 처리할거에요!!**</br>
- 또한 그 처리 속도는 매우 빠를거에요 마치 동시에 작업을 처리하는 것 처럼 말이죠.

이게 바로 **동시성 프로그래밍** 입니다.

**✅ 동시성 프로그래밍은 위 예시와 같습니다.**</br>
- 여러 개의 스레드를 이용하여 동시에 여러 작업을 처리합니다.
- 여러 가지 작업을 나열해두고 하나씩, 그리고 조금씩 번갈아가면서 작업을 처리합니다.
    - 그 처리 속도는 매우 빨라서 동시에 작업을 처리하는 것처럼 보여집니다.
        - 아주 빠르게 **Context Switching**을 하고 있는 것입니다.

---

### 살짝 맛보기 - 직렬성(Serial) 프로그래밍 🥴</br></br>

**💡동시성 프로그래밍과 반대되는 개념입니다.**</br>

**💡동시성 프로그래밍은 `다중 스레드`를 활용하지만 직렬성 프로그래밍은 `단 하나의 스레드`에서만 작업을 하는 것입니다.**
- 즉 동시에 작업을 처리하지 못하고, 순서대로 작업을 처리해야합니다.

---

## 병렬 프로그래밍과 동시성 프로그래밍에 대한 오해 😎</br>

### 1️⃣ 동시성 프로그래밍은 병렬 프로그래밍과 반대되는 개념이 아니다!</br>
- 병렬 프로그래밍은 **다중 코어**, 동시성 프로그래밍은 **다중 스레드**를 활용하는 것이며 이 둘은 동시에 일어날 수도 있습니다.
- 소프트웨어를 개발하는데에 있어서 **동시성 프로그래밍과 병렬 프로그래밍의 개념만 이해하고 있어도 됩니다.**
    - 어떤 코어에서, 어떤 스레드에서 작업을 처리해줄지에 대해서는 직접 구현할 일이 없고 시스템에서 알아서 처리해줄 것이기 때문입니다.

### 2️⃣ 여러 가지 일을 여러 개의 코어에서 담당하는 것은 병렬 프로그래밍이 아니다!</br>
- 정확히는 **병렬 프로그래밍일 수도 있고, 아닐 수도 있습니다.**
    - 그 이유는 시스템에서 어떻게 일을 처리하게 하는지 정확히 알 수 없기 때문입니다.
- **하지만 4가지 일을 4개의 코어가 하나씩 담당해서 한다고 생각했을 때 이것은 사실 병렬 프로그래밍이 아닙니다.**
- **병렬 프로그래밍은 한 가지의 일을 여러 코어가 분담해서 하는 것 입니다.**
    - 위에서 말한 상황(4가지 일을 4개의 코어가 하나씩 담당)은 각 코어가 일을 하나씩 맡아서 처리하는 상황일 뿐입니다.</br>

별개의 이야기지만 일을 처리하는 내부적인 환경은 단일 스레드 환경일 수도 있고, 다중 스레드 환경일 수도 있습니다.

---

## 동기와 비동기</br>

**`동기(Synchronous)`와 `비동기(Asynchronous)`라는 용어를 이해해봅시다.**</br>
- 앞서 다루었던 병렬 프로그래밍과 동시성 프로그래밍과는 전혀 다른 맥락입니다.
- **✅ 동시성 프로그래밍을 하는데에 있어서 동기/비동기를 이해하는 것은 매우 중요합니다.**
    - **그래야 정확하게 의도대로 코드를 동작시킬 수 있기 때문입니다.**

## 1️⃣ 동기</br>

**✅ 동기 프로그래밍은 작업이 끝나기를 기다리는 것입니다.**</br>
- 예를 들어 A라는 코드 블록을 동기로 처리했다면 A라는 코드의 실행이 완전히 끝나야 다음 코드로 넘어가는 것입니다.
<img src = "https://github.com/devKobe24/images/blob/main/%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%E1%84%8B%E1%85%A1%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%B7.gif?raw=true"></br>

## 2️⃣ 비동기 </br>

**✅ 비동기 프로그래밍은 작업이 끝나기를 기다리지 않고 다음 코드 블록을 바로 실행시키는 코드입니다.**</br>
- 예를 들어 A, B라는 작업이 나열되어 있고 A를 비동기 처리해주었을 때 A를 기다리지 않고 바로 B 작업을 시작하게 됩니다.
<img src = "https://github.com/devKobe24/images/blob/main/%E1%84%87%E1%85%B5%E1%84%83%E1%85%A9%E1%86%BC%E1%84%80%E1%85%B5%E1%84%8B%E1%85%A1%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%B7.gif?raw=true"></br>

## 3️⃣ 동기와 비동기의 차이</br>

**✅ 동기와 비동기는 작업이 끝나기를 기다리느냐 기다리지 않느냐에 대해서 구분되는 개념입니다.**</br>
- **이러한 개념의 차이는 `실행 종료 시점을 알 수 있는 가`에 대한 차이로 이어집니다.**
    - **동기로 처리되는 작업은 무조건 작업이 종료되길 기다리게 되니 작업이 종료된 후에 할 일을 정해줄 수 있습니다.**
    - **비동기의 경우에는 언제 작업이 종료되는지를 알 수 없습니다. 그 이유는 작업이 끝나기를 기다리지 않기 때문입니다.**

## 4️⃣ 동시성과 비동기의 차이</br>

**✅ 동시성과 비동기는 완전히 다른 이야기입니다.**</br>
- **동시성 : Serial이냐, Concurrent인가는 스레드가 단일 스레드인가, 다중 스레드인가의 구분.**
- **동기/비동기 : 스레드의 수와는 무관하게 작업이 끝나기를 기다리냐, 기다리지 않느냐의 구분.**</br>

**Serial 환경에서 비동기로 처리할 수도 있고, 동기로 처리할 수 있습니다.**</br>

**그리고 Concurrent 환경에서 동기로 처리할 수 있고 비동기로 처리할 수 있습니다.**</br>

**🙌 따라서 이 둘은 완전히 다른 문제로 보아야 합니다.**

---

## 동시성 프로그래밍이 필요한 이유 👨‍🔬</br>

## 1️⃣ 효율적으로 동작하는 소프트웨어</br>

**✅ 동시성 프로그래밍은 여러 개의 스레드를 이용해서 일을 나누어 효율적인 작업 처리를 할 수 있게 합니다.**</br>

**🚨 동시성 프로그래밍을 하지 않으면 모든 일을 하나의 스레드에서 담당하게 됩니다.**

- 동시성 프로그래밍을 하게 되면 소프트웨어가 더 쾌적하고 효율적으로 동작할 수 있게 해줍니다.
- 동시성 프로그래밍을 하게 되면 성능을 개성하여 최적화로 이어지기도 합니다.</br>

## 2️⃣ 사용성, 반응성이 좋은 소프트웨어</br>

효율적으로 동작한다는 이점은 결국 **사용성, 반응성**이 좋아진다로 귀결됩니다.</br>

개발자는 동시성 프로그래밍을 통해 **사용자에게 보다 나은 사용성을 제공할 수 있습니다.**</br>

예를 들어 어떤 파일을 다운받을 때 사용자가 아무런 동작을 할 수 없다면 사용자는 답답함과 불편함을 느낄 것입니다.</br>

또 서버로 부터 정보를 받아오는 동안 앱이 동작하지 않는다면 사용자는 답답함과 불편함을 느낄 것 입니다.</br>

**✅ 반대로 최적화가 잘 되어 있는 앱을 사용하면 쾌적한 느낌을 받게 됩니다.**</br>
- 아래의 예시를 봐봅시다.</br>

<img src = "https://github.com/devKobe24/images/blob/main/%E1%84%83%E1%85%A9%E1%86%BC%E1%84%89%E1%85%B5%E1%84%89%E1%85%A5%E1%86%BC%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%84%86%E1%85%B5%E1%86%BC%E1%84%8B%E1%85%A8%E1%84%89%E1%85%B5.gif?raw=true"></br>

**🚨 이 앱의 문제점은 서버에서 사진을 보여줄 때 스크롤이 매끄럽지 못하고 계속 끊기고 있습니다.**
- 서버에서 사진을 가져오는 동안 앱이 멈춰야하기 때문입니다.
    - 이러한 문제가 발생하는 이유는 동시성 프로그래밍을 하지 않아서, 모든 동작이 하나의 스레드에서 동작하고 있기 때문입니다.
        - **🙌 여기서 말하는 하나의 스레드는 메인 스레드(Main thread)입니다.**

---

## Swift와 동시성 프로그래밍

Swift로 동시성 프로그래밍을 구현하는 방법으로는 **GCD, Operation, async/await**가 있습니다.</br>

GCD는 이 셋 중에 가장 먼저 등장했던 것 입니다.</br>

GCD는 Operation의 근간이 되는 API입니다.</br>

Operation은 GCD를 기반으로 만들어졌으며 세부적인 기능들이 추가된 API입니다.</br>

async/await는 Swift 5.5 버전에서 등장하게 된 셋 중에서는 가장 최신의 것입니다.</br>
- Swift에 등장한 것이 최신이라는 말이지, 사실은 다른 언어에 있는 문법을 Swift화해서 가져온 것입니다.

---
