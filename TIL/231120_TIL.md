# SILGen Intro.

SILGen에 대해서 알아보기 위해 저는 먼저 [swift.org](https://www.swift.org/swift-compiler/)를 찾아갔습니다.

(역시 없는것이 없어!! 보물창고 헤헿 😆)

그리고 여기서 안내해준 [swift/docs/SIL.rst](https://github.com/apple/swift/blob/main/docs/SIL.rst#silgen)에서 SILGen을 찾아봤습니다.

그렇다면 이곳에서 무엇이라고 설명해주었을지 알아볼까요?!

# 1️⃣ SILGen(Swift Intermediate Language Generator).

**SILGen** 은 타입 체크가 완료된 **Swift AST(Abstract Syntax Tree, 추상 구문 트리)** 를 순회하며 **raw SIL**을 생성합니다.

(오호라 우리 **AST(Abstract Syntax Tree, 추상 구문 트리)** 가 무엇인지 알아봐야 할 것 같아요!! 🙌)

## ✅ 1. AST(Abstract Syntax Tree, 추상 구문 트리).

**Swift AST(Abstract Syntax Tree, 추상 구문 트리)** 는 소스 코드의 구조적 표현입니다.

프로그래밍 언어에서, 추상 구문 트리는 소스 코드의 구조를 Tree 형태로 표현한 것입니다.

각 노드는 소스 코드의 일부를 나타내며, 이는 코드의 구조적인 이해와 처리를 용이하게 합니다.

**Swift AST** 는 Swift 코드가 컴파일 과정에서 어떻게 분석되고 변환되는지를 이해하는 데 중요한 요소입니다.

Swift 컴파일러는 소스 코드를 먼저 AST로 변환하고, 이 AST를 통해 다양한 최적화, 타입 체크, 코드 변환 등을 수행합니다.

**AST는 다음과 같은 특징을 가지고 있습니다.**

> 🙋‍♂️ **AST 특징.**
> 
> >**1. 계층적 구조 :** AST는 트리 구조를 가지며, 각 노드는 연산자, 피연산자, 선언, 표현식 등 코드의 구성 요소를 나타냅니다.
> >
> >**2. 추상화 :** AST는 코드의 구문적 구조를 나타내지만, 코드 작성의 세부적인 문법(예: 괄호의 위치, 공백 등)은 추상화하여 생략합니다.
> >
> >**3. 분석 용이성 :** AST는 컴파일러나 다른 도구들이 소스 코드를 더 쉽게 분석하고 처리할 수 있게 해줍니다. 예를 들어, 타입 체크, 범위 분석, 최적화 등을 수행할 때 유용합니다.

## 👍 AST(Abstract Syntax Tree, 추상 구문 트리) 마무리.

**Swift에서 AST** 는 소스 코드를 **중간 언어(SIL, Swift Intermediate Language)** 로 변환하는 과정에서 매우 중요한 역할을 합니다.

컴파일러는 이 AST를 사용하여 소스 코드의 의미를 분석하고, 필요한 변환을 수행하여 실행 가능한 코드로 만듭니다.

### 📝 NOTE: 추상화(Abstraction)🤔?

**추상화(Abstraction)** 는 복잡한 데이터, 프로세스, 시스템 등을 더 단순한 형태로 표현하는 과정입니다.

프로그래밍에서 추상화는 필수적인 세부 사항을 제외하고 주요 개념이나 기능에 집중함으로써, 복잡성을 관리할 수 있게 합니다.

### 📝 NOTE: AST에서의 추상화🤔?

**AST에서의 추상화**는 코드의 구문적 구조를 나타내는 데 초점을 맞추면서, 코드 작성 시 사용되는 세부적인 문법적 요소들(공백, 줄바꿈, 괄호의 위치 등)를 생략하는 것을 의미합니다.

이러한 요소들은 프로그램의 실행이나 로직에 직접적인 영향을 주지 핞기 때문에 추상화 과정에서 제거됩니다.

예를 들어, 다음 두 코드 조각은 서로 다른 문법적 형태를 가지고 있지만, 동일한 추상 구문 트리(AST)로 표현될 수 있습니다.

```swift
let result = 1 + 2
```

```swift
let result=1+2
```

여기서 공백의 차이는 코드의 의미나 구조에 영향을 미치지 않으므로, AST는 이러한 차이를 무시하고 동일한 트리 구조로 두 코드 조각을 표현할 것입니다.

이처럼 추상화는 코드의 본질적인 부분에 집중하게 하여, 분석이나 변환과 같은 프로세스를 단순화하고 오류를 줄이는 데 도움을 줍니다.

(와우!! 많은것을 알아봤어요 그럼 다시 SILGen에 대해서 알아볼까유우~🙌)

**SILGen에 의해 방출된 SIL의 형태는 다음과 같은 특성을 가지고 있습니다.**

# 2️⃣ SILGen에 의해 방출된 SIL의 특성.

## 첫 번째 !

변수들은 엄격한 SSA(Static Single Assignment)형태가 아닌, 가변적인 메모리 위치를 로딩하고 저장함으로써 표현됩니다. 
이는 Clang과 같은 프론트엔드에 의해 방출된 초기의 `alloca`-heavy LLVM IR과 유사합니다. 
그러나 Swift에서는 변수를 가장 일반적인 경우에 참조 카운팅된 "박스"로 표현합니다.
이 박스는 retain(유지), release(해제), captured into closures(클로저에 의해 캡처)될 수 있습니다.

(워메 모르는거 또 나와부럿네.. 이거 또 알고 넘어가야것지요~💯)

## ✅ 2. SSA(Static Single Assignment)

**SSA(Static Single Assignment)** 는 프로그래밍 언어의 컴파일러 설계에서 사용되는 속성으로, 각 변수가 프로그램 내에서 단 한 번만 할당(assign)될 수 있도록 프로그램 코드를 변환하는 기법입니다.

SSA 형태의 코드에서는 모든 변수가 정확히 한 번만 정의되며, 각 변수의 사용은 그 정의를 명확히 참조합니다.

**SSA의 주된 장점**은 컴파일러 최적화를 단순화하고 효율적으로 만든다는 것입니다.
SSA형식을 사용함으로써, 컴파일러는 변수의 값이 어디에서 정의되고, 어디에서 사용되는지를 더 쉽게 추적할 수 있습니다.
이로 인해 데이터 흐름 분석과 같은 최적화가 더 명확하고 쉽게 수행될 수 있습니다.

**Swift의 컴파일 단계 중 하나인 SILGen**은 타입 검사가 완료된 AST를 raw SIL로 변환하는데, 이때 생성된 SIL은 SSA 형식을 엄격히 따르지 않고, 대신 가변적인 메모리 위치에 변수를 로딩하고 저장하는 형태로 표현됩니다.

이후의 컴파일 단계에서 이 raw SIL은 SSA 형태로 변환될 수 있으며, 추가적인 최적화와 분석이 수행됩니다.

## ✅ 3. 왜 SIL은 SSA 형식을 따르지 않고, 대신 가변적인 메모리 위치에 변수를 로딩하고 저장하는 형태로 표현할까🤔?

SILGen(Swift Intermediate Language Generator) 에 의해 생성된 초기 SIL(Swift Intermediate Language) 이 엄격한 SSA(Static Single Assignment) 형식을 따르지 않고 가변적인 메모리 위치에 변수를 로딩하고 저장하는 형태로 표현되는 이유는 **Swift 언어의 특성과 목표에 기인합니다.**

Swift는 **안정성(Security)**, **표현성(Expressiveness)** 그리고 **성능(Performance)** 을 중시하는 언어이며, 이를 달성하기 위해 **다음과 같은 이유로 raw SIL에서 가변 메모리 위치를 사용합니다.**

> 🙋‍♂️ **가변 메모리 위치를 사용하는 이유.**
> 
> >**1. 참조 계수와 관리 :** Swift는 자동 참조 계수(ARC)를 사용하여 메모리를 관리합니다. 객체의 생명주기는 retain과 release 호출에 의해 관리되며, 이를 위해 변수들은 참조 계수를 관리할 수 있는 '박스화된' 메모리 위치에 저장됩니다.
> >
> >**2. 변수의 캡처 :** Swift의 클로저는 주변 범위의 변수를 캡처할 수 있습니다. 이 때, 변수들은 변경 가능하거나 참조를 통해 캡처될 수 있기 때문에, 가변 메모리 위치에 저장되는 것이 유리합니다.
> >
> >**3. 성능 최적화 :** 초기 SIL 생성 단계에서는 최적화보다는 코드의 정확한 의미를 충실히 반영하는 것이 중요합니다. SSA 형식은 최적화에 유리하지만, 초기 단계에서는 모든 변수 할당과 참조 관계를 명확히 표현하기 위해 가변 메모리 위치를 사용합니다.
> >
> >**4. 후속 최적화 :** raw SIL 에서는 최적화를 적용하기 전의 코드를 나타냅니다. 후속 컴파일 단계에서 SSA 형식으로 변환하고 다양한 최적화를 수행함으로써, 더 효율적인 코드로 개선할 수 있습니다.
> >
> >**5. 유연성 :** 가변 메모리 위치에 변수를 저장하는 방식은 유연성을 제공하며, 컴파일러가 다양한 변환과 최적화를 적용하기 위한 출발점으로 사용됩니다.

## 👍 3. '왜 SIL 가변적인 메모리 위치에 변수를 로딩하고 저장하는 형태로 표현할까?' 마무리.

따라서, SILGen은 Swift의 고수준 기능들과 메모리 관리 메커니즘을 정확히 표현할 수 있는 raw SIL을 생성하는 것을 목표로 합니다.
이는 컴파일 프로세스의 후반부에서 보다 정교한 최적화를 가능하게 하는 기반을 마련합니다.

## 두 번째 !

확실한 할당(definitive assignment), 함수 반환(function returns), 스위치 커버리지(TBD), 등과 같은 데이터 흐름 요구 사항(Dataflow requirements)은 아직 시행되지 않았습니다.

> 🙋‍♂️ **Definitive assignment(확실한 할당)?**
> 
> > 이는 모든 변수가 사용되기 전에 반드시 한 번은 값이 할당되어야 함을 의미합니다.
> > 즉, 프로그램 내에서 모든 변수가 초기화되고 사용되기 전에 적절한 값으로 설정되어야 함을 보장합니다.
> > 이는 런타임 오류를 방지하고 프로그램의 안정성을 높이는 데 중요합니다.

> 🙋‍♂️ **function returns(함수 반환)?**
> 
> > 이는 함수가 모든 실행 경로에서 적절한 반환 값을 제공해야 함을 의미합니다.
> > 즉, 함수의 정의에 따라 모든 가능한 경우에서 반환 값이나 반환 유형이 명확하게 지정되어야 합니다.
> > 이는 프로그램의 예측 가능성과 안정성을 보장하는 데 중요한 요소입니다.

> 🙋‍♂️ **Switch coverage(스위치 커버리지)?**
> 
> > 스위치 문의 모든 가능한 경우에 대해 적절한 처리가 되어야 함을 의미합니다.
> > 스위치 문은 다양한 경우를 포괄적으로 다루어야 하며, 누락된 경우가 없어야 합니다.

> 🙋‍♂️ **Dataflow requirements(데이터 흐름 요구사항)?**
> 
> > 프로그램의 실행 동안 데이터가 어떻게 이동하고 처리되어야 하는지에 대한 규칙이나 조건들을 의미합니다.
> > 이는 변수의 스코프, 생명 주기, 사용되는 방식 등을 포함하여, 프로그램의 논리적 정확성과 효율성을 보장하는 데 중요합니다.

## 마지막 !

`transparent` 함수(transparent function) 최적화는 아직 적용되지 않았습니다.

> **transparent function**
> 
> 프로그래밍에서 **"transparent function"** 라는 용어는 일반적으로 컴파일러 최적화의 맥락에서 사용되며, 특히 Swift 언어에서는 **`@transparent`** 특성과 관련이 깊습니다.
> 
> **transparent function**은 컴파일러에 의해 특별한 방식으로 처리되는 함수를 의미합니다.
> 이러한 함수는 컴파일 타임에 더 깊게 분석되고 최적화될 수 있으며, 이는 런타임 성능 향상에 기여할 수 있습니다.
> 
> Swift에서 **`'@transparent'`** 특성을 가진 함수는 다음과 같은 특징을 가집니다.
> 
> 🙋‍♂️ **`@transparent` 함수의 특징.**
> 
> > **1. 인라인 확장.**
> > **transparent function**은 호출 지점에서 인라인 확장될 수 있습니다.
> > 이는 함수 호출 오버헤드를 줄이고, 호출된 함수의 본문이 호출 지점에 직접 삽입되어 성능을 향상 시킬 수 있습니다.
> > 
> > **2. 최적화에 용이.**
> > 컴파일러는 **transparent function**의 본문을 더 깊이 분석하여 고급 최적화를 수행할 수 있습니다.
> > 예를 들어, 불필요한 연산을 제거하거나, 더 효율적인 코드 경로를 선택하는 등의 최적화가 가능합니다.
> > 
> > **3. 컴파일 타입 분석.**
> > **transparent function**은 컴파일 시에 더 자세히 분석되어, 런타임에서의 예상치 못한 동작을 방지하고 성능을 향상시키는 데 도움을 줍니다.
> 

👍 **`@transparent` 함수 마무리.** 

**`@transparent`** 특성은 주로 Swift 표준 라이브러리 또는 성능이 중요한 저수준 코드에서 사용됩니다.

**그러나 개발자가 이 특성을 임의로 사용하는 것은 권장되지 않으며, 일반적으로 컴파일러나 라이브러리 개발자에 의해 신중하게 사용됩니다.**

# 3️⃣ SILGen 마무리.

이러한 특성들은 raw SIL에 대해 항상 실행되는 보장된 최적화 및 진단 패스에 의해 후속 처리됩니다.

오늘은 **SILGen** 에 살짝쿵 찍먹해봤어요 ㅎㅎ

다음에는 오늘 못다룬 세세한 부분들을 조금씩 가져와보겠습니다아 헤헿

오늘은 여기까지 안뇨오오오오옹 😆
