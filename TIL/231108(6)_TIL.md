# iOS 메모리 구조에서 Stack 메모리 영역과 Heap 메모리 영역.

iOS 메모리 구조에서 Stack 메모리 영역과 Heap 메모리 영역은 다음과 같은 특징을 가지고 있습니다.

## Stack 메모리 영역.

### 1. 정의.

Stack 영역은 함수 호출 시 생성되는 지역 변수, 매개 변수 및 반환 주소를 저장하는데 사용됩니다.

### 2. 생명 주기.

함수가 호출될 때 생성되고, 함수가 반환되면 소멸합니다.

### 3. 관리.

컴파일러에 의해 자동으로 관리됩니다. 개발자가 직접 할당하거나 해제할 필요가 없습니다.

### 4. 특징.

Stack은 LIFO(Last In, First Out)원칙으로 작동합니다.

가장 마지막에 들어온 요소가 가장 먼저 나갑니다.

### 5. 성능.

메모리 할당과 해제가 빠르며, 성능상의 이점이 있습니다.

### 6. 제한.

Stack 영역의 크기는 제한 적이며, 컴파일 시 결정됩니다.

너무 많은 메모리를 사용하면 스택 오버플로우(Stack overflow)가 발생할 수 있습니다.

## Heap 메모리 영역.

### 1. 정의.

Heap 영역은 동적으로 할당되는 메모리(즉, 실행 시간에 할당되는 메모리)를 위한 공간입니다.

### 2. 생명 주기.

개발자가 명시적으로 할당하고 해제해야 합니다.

Swift에서는 `ARC(Automatic Reference Counting)`가 이 작업을 자동화합니다.

### 3. 관리.

개발자가 `malloc`, `calloc`, `new` 등을 사용해 직접 관리하거나, 높은 수준의 언어에서는 가비지 컬렉터나 `ARC` 같은 메모리 관리 기법에 의해 관리됩니다.

### 4. 특징.

`Heap`은 Stack에 비해 더 유연하며, 더 큰 메모리 할당이 가능합니다.

### 5. 성능.

메모리 할당과 해제가 `Stack`에 비해 느리며, 메모리 단편화 등의 문제가 발생할 수 있습니다.

> 메모리 단편화(Memory Fragmentation).
> 
> 사용 가능한 메모리가 작은 조각으로 나뉘어져서 실제로는 충분한 양의 메모리가 있음에도 불구하고, 연속적인 메모리 공간을 필요로 하는 큰 메모리 요청을 충족시키지 못하는 상황을 말합니다.
>
> 이는 특히 메모리를 동적으로 할당하고 해제하는 과정에서 자주 발생합니다.
>
> 매모리 단편화(Memory Fragmentation)는 두 가지 주요 형태로 나타납니다.
> 
>> 1. **외부 단편화(External Fragmentation)**
>>
>> 전체 메모리 중 사용 중이지 않은 공간이 있지만, 이 공간들이 작은 블록으로 흩어져 있어서 큰 메모리 블록을 할당할 수 없는 상태를 말합니다.
>>
>> 예를 들어, 어떤 프로그램이 10MB의 연속적인 메모리를 요구하는데, 사용 가능한 메모리는 총 10MB 이상이지만 2MB 조각들로 흩어져 있다면, 이 큰 요청을 충족 시키지 못합니다.
>> 
>>
>> 2. **내부 단편화(Internal Fragmentation)**
>> 
>> 메모리가 할당될 때, 할당된 블록의 크기가 요청된 양보다 커서, 할당된 블록 내에 사용되지 않는 남는 공간이 생기는 상태를 말합니다.
>> 
>> 예를 들어, 시스템이 항상 4KB 블록으로 메모리를 할당한다면, 1KB만 필요한 프로그램에게도 4KB 블록이 할당되고, 남는 3KB는 내부 단편화를 일으킵니다.
>
> 메모리 단편화를 줄이기 위한 일반적인 방법에는 가비지 컬렉션, 메모리 풀링, 페이징(paging), 세그먼테이션(segmentation) 등이 있으며, 각기 다른 전략과 기술을 사용하여 메모리를 효율적으로 관리하고 최적화합니다.
> 
> 예를 들어, iOS는 메모리 단편화를 줄이기 위해 컴팩션(compaction), 적극적인 메모리 회수, 그리고 효율적인 메모리 할당 전략을 사용합니다.
>
> 이러한 방법은 메모리 사용의 효율성을 높이고 애플리케이션의 성능을 개선하는 데 도움을 줍니다.

### 6. 제한.

사용 후에 해제하지 않는 메모리는 메모리 누수(memory leak)를 발생시킬 수 있습니다.

## 마무리.

`Swift`에서 클래스의 인스턴스는 `Heap`에 할당되며, 구조체는 주로 `Stack`에 할당됩니다.
- 단, 구조체가 클로저와 같은 참조 타입을 캡쳐할 때나, 함수를 거쳐 다른 스코프로 전달될 때는 `Heap`에 저장될 수 있습니다.

`ARC`는 `Heap`에 저장된 객체의 메모리 관리를 담당하며, 객체가 더 이상 필요 없을 때 자동으로 메모리를 해제합니다.

iOS 메모리 구조의 이러한 특징은 효율적인 메모리 관리를 가능하게 하며, `Swift`와 같은 현재적인 프로그래밍 언어는 이러한 메모리 관리를 더욱 쉽게 만들어 줍니다.

## 참고자료

- [Swift.org : `ARC`](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/automaticreferencecounting/)
