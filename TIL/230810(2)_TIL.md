# Storing Keys in the Keychain</br>í‚¤ì²´ì¸ì— í‚¤ ì €ì¥</br>

> í‚¤ì²´ì¸ì— ì•”í˜¸í™” í‚¤ë¥¼ ì €ì¥í•˜ê³  ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤.</br>

---

# Overview</br>

**âœ… í‚¤ì²´ì¸ì€ ë¹„ë°€ë²ˆí˜¸ë‚˜ ì•”í˜¸í™” í‚¤ì™€ ê°™ì€ ì‘ì€ ë¹„ë°€ì„ ì €ì¥í•˜ê¸°ì— ê°€ì¥ ì¢‹ì€ ì¥ì†Œì…ë‹ˆë‹¤.**</br>

**âœ… í‚¤ì²´ì¸ ì„œë¹„ìŠ¤ APIì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ í‚¤ì²´ì¸ í•­ëª©ì„ ì¶”ê°€, ê²€ìƒ‰, ì‚­ì œ ë˜ëŠ” ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**</br>

[Apple CryptoKit](https://developer.apple.com/documentation/cryptokit) í”„ë ˆì„ì›Œí¬ë¡œ ìƒì„±í•œ ì•”í˜¸í™” í‚¤ë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [Storing CryptoKit Keys in the Keychain](https://developer.apple.com/documentation/cryptokit/storing_cryptokit_keys_in_the_keychain) ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”</br>

---

# Create a Query Dictionary</br>

[Generating New Cryptographic Keys](https://developer.apple.com/documentation/security/certificate_key_and_trust_services/keys/generating_new_cryptographic_keys)ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ ì§ì ‘ í‚¤ë¥¼ ìƒì„±í•˜ëŠ” ê²½ìš°, í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ì˜ ì•”ì‹œì  ì¼ë¶€ë¡œ í‚¤ ì²´ì¸ì— í‚¤ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</br>

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ í‚¤ë¥¼ ì–»ì€ ê²½ìš°ì—ë„ í‚¤ ì²´ì¸ì— ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</br>

ì´ë ‡ê²Œ í•˜ë ¤ë©´ ë¨¼ì € í• ëª©ì„ í¬í•¨í•˜ê³  ì„¤ëª…í•˜ëŠ” Query Dictionaryë¥¼ ë§Œë“­ë‹ˆë‹¤.</br>

```swift!
let key = <# a key #>
let tag = "com.example.keys.mykey".data(using: .utf8)!
let addquery: [String: Any] = [kSecClass as String: kSecClassKey,
                              kSecAttrApplicationTag as String: tag,
                              kSecValueRef as String: key]
```

ì´ Query Dictionaryì€(ì¸ì¦ì„œ, ID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì•„ë‹Œ) í‚¤ í•­ëª©ì„ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ [kSecClass](https://developer.apple.com/documentation/security/ksecclasskey) í•­ëª©ì— ëŒ€í•œ [kSecClassKey](https://developer.apple.com/documentation/security/ksecclass) ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</br>

ë˜í•œ ë‚˜ì¤‘ì— í‚¤ë¥¼ ê²€ìƒ‰í•  ë•Œ ë‹¤ë¥¸ í‚¤ì™€ êµ¬ë³„í•  ìˆ˜ ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ íƒœê·¸ë¥¼ ì ìš©í•©ë‹ˆë‹¤.</br>

---

# Store the Item</br>

[SecItemAdd(_:_:)](https://developer.apple.com/documentation/security/1401659-secitemadd) í•¨ìˆ˜ë¥¼ í•˜ìš©í•˜ì—¬ í•­ëª©ì„ ì‹¤ì œë¡œ ì €ì¥í•©ë‹ˆë‹¤.

```swift!
let status = SecItemAdd(addquery as CFDictionary, nil)
guard status == errSecSuccess else { throw <# an error #> }
```

---

# Retrieve the Item</br>ì•„ì´í…œ íšŒìˆ˜</br>

**âœ… í‚¤ë¥¼ ê²€ìƒ‰í•˜ë ¤ë©´ ë™ì¼í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ Query Dictionaryì„ êµ¬ì„±í•©ë‹ˆë‹¤.**</br>

```swift!
let getquery: [String: Any] = [kSecClass as String: kSecClassKey,
                               kSecAttrApplicationTag as String: tag,
                               kSecAttrKeyType as String: kSecAttrKeyTypeRSA,
                               kSecReturnRef as String: true]
```

ìœ„ì˜ DictionaryëŠ” [Creating an Asymmetic Key Pair](https://developer.apple.com/documentation/security/certificate_key_and_trust_services/keys/generating_new_cryptographic_keys#2863927)ì—ì„œì™€ ê°™ì´ [kSecAttrKeyTypeRSA](https://developer.apple.com/documentation/security/ksecattrkeytypersa) ìœ í˜•ì´ì–´ì•¼ í•˜ë©°, í•´ë‹¹ ì˜ˆì œ ë° ìœ„ì— ì‚¬ìš©ëœ íƒœê·¸ê°€ ìˆì–´ì•¼ í•¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</br>

ë§ˆì§€ë§‰ ì¤„ì€ ê²€ìƒ‰ì´ ì‹¤ì œ í‚¤ ë°ì´í„°ì™€ ë°˜ëŒ€ë¡œ í‚¤ ì°¸ì¡°ë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤ê³  ë§í•©ë‹ˆë‹¤.(ì˜ˆë¥¼ ë“¤ì–´ ì‹¤ì œ í‚¤ ë°ì´í„°ì™€ ë°˜ëŒ€ë¡œ)</br>

> ğŸ“Œ Note</br>
> ì´ëŠ” í•„ìš”í•œ ë§Œí¼ ê²€ìƒ‰ì„ ì„¸ë¶„í™”í•˜ì§€ ì•ŠëŠ” ê°„ë‹¨í•œ Queryì…ë‹ˆë‹¤.</br>
> ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì¶”ê°€ ë°©ë²•ì€ ì•„ë˜ [Refine the Search](https://developer.apple.com/documentation/security/certificate_key_and_trust_services/keys/storing_keys_in_the_keychain#2940891) ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.</br>

ì´ Queryë¥¼ [SectionCopyMatching(_:_:)](https://developer.apple.com/documentation/security/1398306-secitemcopymatching) í•¨ìˆ˜ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰ì„ ì‹¤í–‰í•˜ê³  ì œê³µí•œ ë¹ˆ ì°¸ì¡°ë¥¼ ì±„ì›ë‹ˆë‹¤.</br>

```swift!
var item: CFTypeRef?
let status = SecItemCopyMatching(query as CFDictionary, &item)
guard status == errSecSuccess else { throw <# an error #> }
let key = item as! SecKey
```

ìƒíƒœ ê²°ê³¼ì— í‘œì‹œëœ ëŒ€ë¡œ í˜¸ì¶œì´ ì„±ê³µí•˜ë©´ ë°˜í™˜ëœ í‚¤ ì°¸ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•”í˜¸í™” ì—°ì‚°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</br>

`Objective-C`ì—ì„œëŠ” ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ê²€ìƒ‰í•œ í‚¤ë¥¼ ì‚¬ìš©í•œ ìš°ë ˆëŠ” í•´ë‹¹ ë©”ëª¨ë¦¬ë¥¼ í•´ì œí•´ì•¼ í•©ë‹ˆë‹¤.</br>

`Swift`ì—ì„œëŠ” ì‹œìŠ¤í…œì´ ê°ì²´ì˜ ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</br>

---

# Refine the Search</br>ê²€ìƒ‰ ì„¸ë¶„í™”</br>

ìœ„ ì˜ˆì˜ QueryëŠ” ê²€ìƒ‰ì„ íŠ¹ì • í‚¤ í´ë˜ìŠ¤(ê³µê°œ, ë¹„ê³µê°œ ë˜ëŠ” ëŒ€ì¹­) ë˜ëŠ” ê¸°íƒ€ í‚¤ íŠ¹ì„±ìœ¼ë¡œ ì œí•œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</br>

íƒœê·¸ì™€ ìœ í˜•ì— ëŒ€í•´ì„œë§Œ ì¼ì¹˜í•˜ë©°, ì²« ë²ˆì§¸ë¡œ ì„±ê³µì ìœ¼ë¡œ ì¼ì¹˜í•˜ëŠ” í•­ëª©ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</br>

íŠ¹ì • ìœ í˜•ì˜ ëª¨ë“  í‚¤ì— ê³ ìœ  íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•¨ ê²€ìƒ‰ì„ ì‹¤í–‰í•  ë•Œ ì›í•˜ëŠ” í‚¤ë¥¼ ì–»ì§€ ëª»í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</br>

ì¼ì¹˜í•˜ëŠ” ì²« ë²ˆì§¸ í‚¤ë§Œ ë°˜í™˜ë˜ë©°, ê·¸ í‚¤ê°€ ì›í•˜ëŠ” í‚¤ì¼ ìˆ˜ë„ ìˆê³  ì•„ë‹ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</br>

> âœï¸ ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì—ëŠ” ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</br>

- **Widen the search(ê²€ìƒ‰ ë²”ìœ„ ë„“íˆê¸°).** Query Dictionaryì— ë‹¨ì¼ í‚¤ ì°¸ì¡° ëŒ€ì‹  [kSecMatchLimitAll](https://developer.apple.com/documentation/security/ksecmatchlimitall) í•­ëª©ì„ ì¶”ê°€í•˜ë©´ [kSecMatchLimit](https://developer.apple.com/documentation/security/ksecmatchlimit) í•­ëª©ì„ ì¶”ê°€í•˜ë©´ [SecItemCopyMatching(_:_:)](https://developer.apple.com/documentation/security/1398306-secitemcopymatching)ì´ í‚¤ ì°¸ì¡° ë°°ì—´ì„ ìƒì„±í•˜ê³ , ì´ë¥¼ ê²€ì‚¬í•˜ì—¬ ê´€ì‹¬ ìˆëŠ” í‚¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</br>
- **Narrow the search(ê²€ìƒ‰ ë²”ìœ„ ì¢íˆê¸°).** í‚¤ ë˜ëŠ” í‚¤ í´ë˜ìŠ¤ì™€ ê°™ì´ í‚¤ë¥¼ êµ¬ë³„í•˜ëŠ” ë‹¤ë¥¸ ì†ì„±ì´ ìˆëŠ” ê²½ìš° ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ê¸° ì „ì— Query Dictionaryì— í•´ë‹¹ í•­ëª©ì„ ì¶”ê°€í•˜ì‹­ì‹œì˜¤.</br>
- **Avoid reusing tags in the first place.(ì²˜ìŒë¶€í„° íƒœê·¸ë¥¼ ì¬ì‚¬ìš©í•˜ì§€ ì•Šê¸°).** íŠ¹ì • íƒœê·¸ì™€ ìœ í˜•(ë˜ëŠ” ë‹¤ë¥¸ êµ¬ë³„ë˜ëŠ” íŠ¹ì„±)ì´ ìˆëŠ” í‚¤ë¥¼ ì¶”ê°€í•˜ì§€ ê±´ì— í‚¤ ì²´ì¸ì—ì„œ ë™ì¼í•œ íŠ¹ì„±ì„ ê°€ì§„ ê¸°ì¡´ í‚¤ë¥¼ ì½ì–´ë³´ì‹­ì‹œì˜¤.</br>ì¤‘ë³µ ê°€ëŠ¥ì„±ì´ ìˆëŠ” í‚¤ë¥¼ ë°œê²¬í•˜ë©´ ì›ë³µ í‚¤ë¥¼ ì¬ì‚¬ìš©í•˜ê³  ìƒˆ í‚¤ë¥¼ ë§Œë“¤ì§€ ì•Šê³ ë‚˜, ë‹¤ë¥¸ íƒœí¬ê¸€ ì‚¬ìš©í•˜ì—¬ ìƒˆ í‚¤ë¥¼ ë§Œë“¤ê±°ë‚˜, ìƒˆ í‚¤ë¥¼ ì¶”ê°€í•˜ê¸° ì „ì— [SecItemDelete(_:)](https://developer.apple.com/documentation/security/1395547-secitemdelete) í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ì „ í‚¤ë¥¼ ì‚­ì œí•˜ì‹­ì‹œì˜¤.</br>
