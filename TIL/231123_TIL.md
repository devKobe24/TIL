# ê¸°ìˆ  ë¸”ë¡œê·¸ì™€ ë‚˜ì˜ ì˜ê²¬ ê·¸ë¦¬ê³  í•´ê²°.

ì–´ëŠ ê¸°ìˆ  ë¸”ë¡œê·¸ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê¸€ì´ ì“°ì—¬ìˆì—ˆìŠµë‹ˆë‹¤.

>â€œSILì€ ì •ì  ë‹¨ì¼ ë°°ì • ë°©ì‹(Static single assignment form)ì— ê°€ê¹Œìš´ ì–¸ì–´ì¸ë“¯í•©ë‹ˆë‹¤.
>ìƒìˆ˜ë§Œì„ í—ˆìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´, Swiftì˜ varë¥¼ ì‚¬ìš©í–ˆì„ ë•Œ letìœ¼ë¡œ í‘œí˜„ì´ ë°”ë€ŒëŠ” ê±¸ê¹Œ?ë¼ê³  ì¶”ì¸¡í–ˆì§€ë§Œ, ìŠ¤ìœ„í”„íŠ¸ì™€>ëŠ” ë³„ê°œë¡œ SIL ì–¸ì–´ê°€ ê·¸ë ‡ê²Œ ì„¤ê³„ë˜ì–´ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.â€

ì´ ê¸€ì„ ë³´ê³  ì €ëŠ” ì˜ë¬¸ì ì´ ë“¤ì—ˆê³  ì˜ë¬¸ì ì„ í•´ê²°í•´ ë‚˜ê°€ëŠ” ê³¼ì •ì—ì„œ ìœ„ ê¸€ê³¼ëŠ” **ë°˜ëŒ€ë˜ëŠ” ì˜ê²¬ì„ ê°–ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.**

# âœ… ë°˜ëŒ€ë˜ëŠ” ê·¼ê±°ì™€ ì˜ê²¬

## 1. Apple ë ˆí¬ì§€í† ë¦¬ ë‚´ë¶€ swift docsì˜ ë‚´ìš©ê³¼ ë‹¤ë¥¸ ë‚´ìš©.

ë¸”ë¡œê·¸ ê¸€ ì¤‘ ì œê°€ ì£¼ëª©í•œ ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

**"Swiftì˜ varë¥¼ ì‚¬ìš©í–ˆì„ ë•Œ letìœ¼ë¡œ í‘œí˜„ì´ ë°”ë€ŒëŠ” ê±¸ê¹Œ?ë¼ê³  ì¶”ì¸¡í–ˆì§€ë§Œ, ìŠ¤ìœ„í”„íŠ¸ì™€ëŠ” ë³„ê°œë¡œ SIL ì–¸ì–´ê°€ ê·¸ë ‡ê²Œ ì„¤ê³„ë˜ì–´ ìˆë‹¤ê³  í•©ë‹ˆë‹¤."**

ì´ ë¬¸ë§¥ì„ ìŠ¤ìŠ¤ë¡œ í•´ì„í•œ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

"Swiftì˜ **`var`** ëŠ” ê°€ë³€ ë³€ìˆ˜ë¥¼ **`let`** ì€ ë¶ˆë³€ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ SILì—ì„œëŠ” Swift ì½”ë“œì˜ **`var`** ê°€ ì‹¤ì œë¡œ **`let`** ì²˜ëŸ¼ ë™ì‘í•œë‹¤ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ëŒ€ì‹ , SILì—ì„œëŠ” ë³€ìˆ˜ì˜ í• ë‹¹ê³¼ ì‚¬ìš©ì´ **SSA í˜•ì‹ì— ê°€ê¹ê²Œ ì²˜ë¦¬ë  ìˆ˜ ìˆìŒ** ì„ ì˜ë¯¸í•©ë‹ˆë‹¤."

ê·¸ëŸ¬ë‚˜

[SILGen](https://github.com/apple/swift/blob/main/docs/SIL.rst#silgen)ì˜ ì²« ë²ˆì§¸ êµ¬ë¶„ì ì— ë‚˜ì™€ìˆëŠ” ê¸€ì„ ë³´ì‹œë©´ ë‹¤ìŒê³¼ ê°™ì´ ê¸°ìˆ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

â€ë³€ìˆ˜ë“¤ì€ ì—„ê²©í•œ **SSA(Static Single Assignment) í˜•íƒœê°€ ì•„ë‹Œ, ê°€ë³€ì ì¸ ë©”ëª¨ë¦¬ ìœ„ì¹˜ë¥¼ ë¡œë”©í•˜ê³  ì €ì¥í•¨ìœ¼ë¡œì¨ í‘œí˜„ë©ë‹ˆë‹¤.** ì´ëŠ” Clangê³¼ ê°™ì€ í”„ëŸ°íŠ¸ì—”ë“œì— ì˜í•´ ë°©ì¶œëœ ì´ˆê¸°ì˜ alloca-heavy LLVM IRê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ Swiftì—ì„œëŠ” ë³€ìˆ˜ë¥¼ ê°€ì¥ ì¼ë°˜ì ì¸ ê²½ìš°ì— ì°¸ì¡° ì¹´ìš´íŒ… ëœ 'ë°•ìŠ¤'ë¡œ í‘œí˜„í•©ë‹ˆë‹¤. ì´ ë°•ìŠ¤ëŠ” retain(ìœ ì§€), release(í•´ì œ), í´ë¡œì €ì— ìº¡ì²˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€

ì €ëŠ” **"ìœ„ Docsì˜ ë‚´ìš©ì„ ê·¼ê±°ë¡œ ë“¤ì–´ SILì€ SSA í˜•ì‹ì— ê°€ê¹ê²Œë„ ì•„ë‹Œ, SSA í˜•ì‹ì„ ë”°ë¥´ì§€ ì•ŠëŠ”ë‹¤"** ê³  ìƒê° í•©ë‹ˆë‹¤.

# âœ… ì•Œë§ì§€ ì•Šì•˜ë˜ 2ë²ˆì˜ ì˜ê²¬ê³¼ ê·¼ê±°.

## 1. Swift Docs - SILGenì˜ ì²« ë²ˆì§¸ êµ¬ë¶„ì .

> Variables are represented by loading and storing mutable memory locations instead of being in strict SSA form. This is similar to the initial alloca-heavy LLVM IR emitted by frontends such as Clang. However, Swift represents variables as reference-counted "boxes" in the most general case, which can be retained, released, and captured into closures.

[Swift Docs - SILGen](https://github.com/apple/swift/blob/main/docs/SIL.rst#silgen)ì˜ ì²«ë²ˆì§¸ êµ¬ë¶„ì ì˜ ë‚´ìš©ì€ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì£¼ëª©í•´ì„œ ë´ì•¼ í•  ë¶€ë¶„ì€ **"Variables are represented by loading and storing mutable memory locations instead of being in strict SSA form."** ë¶€ë¶„ì…ë‹ˆë‹¤.

ì´ ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ì´ í•´ì„ë©ë‹ˆë‹¤.

**"ë³€ìˆ˜ëŠ” ì—„ê²©í•œ SSA í˜•ì‹ì´ ì•„ë‹Œ ë³€ê²½ ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ìœ„ì¹˜ë¥¼ ë¡œë“œí•˜ê³  ì €ì¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í‘œí˜„ë©ë‹ˆë‹¤."**

ìœ„ ë¶€ë¶„ì„ ì¬í•´ì„í•˜ë©´ ì´ë ‡ê²Œë„ í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**"ë³€ìˆ˜ëŠ” SSA í˜•ì‹ ëœ ì—¼ê²©í•˜ê²Œ ì ìš©í•˜ë©°, ë³€ê²½ ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ìœ„ì¹˜ë¥¼ ë¡œë“œí•˜ê³  ì €ì¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í‘œí˜„ë©ë‹ˆë‹¤."**

ë•Œë¬¸ì— ì§ì ‘ **".swift"** íŒŒì¼ì„ **".rawsil"** ë¡œ **ë³€í™˜**í•˜ì—¬ ë‚´ë¶€ë¥¼ í™•ì¸í•´ë³¸ ê²°ê³¼ "SSA í˜•ì‹ì˜ íŠ¹ì„±ì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤."

```rawsil
sil_stage raw

import Builtin
import Swift
import SwiftShims

import Foundation

@_hasStorage @_hasInitialValue let first: Int { get }

@_hasStorage @_hasInitialValue var second: Int { get set }

// first
sil_global hidden [let] @$s4main5firstSivp : $Int

// second
sil_global hidden @$s4main6secondSivp : $Int

// main
sil [ossa] @main : $@convention(c) (Int32, UnsafeMutablePointer<Optional<UnsafeMutablePointer<Int8>>>) -> Int32 {
bb0(%0 : $Int32, %1 : $UnsafeMutablePointer<Optional<UnsafeMutablePointer<Int8>>>):
  alloc_global @$s4main5firstSivp                 // id: %2
  %3 = global_addr @$s4main5firstSivp : $*Int     // user: %15
  %4 = metatype $@thin Int.Type                   // user: %14
  %5 = integer_literal $Builtin.IntLiteral, 1     // user: %8
  %6 = metatype $@thin Int.Type                   // user: %8
  // function_ref Int.init(_builtinIntegerLiteral:)
  %7 = function_ref @$sSi22_builtinIntegerLiteralSiBI_tcfC : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int // user: %8
  %8 = apply %7(%5, %6) : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int // user: %14
  %9 = integer_literal $Builtin.IntLiteral, 2     // user: %12
  %10 = metatype $@thin Int.Type                  // user: %12
  // function_ref Int.init(_builtinIntegerLiteral:)
  %11 = function_ref @$sSi22_builtinIntegerLiteralSiBI_tcfC : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int // user: %12
  %12 = apply %11(%9, %10) : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int // user: %14
  // function_ref static Int.+ infix(_:_:)
  %13 = function_ref @$sSi1poiyS2i_SitFZ : $@convention(method) (Int, Int, @thin Int.Type) -> Int // user: %14
  %14 = apply %13(%8, %12, %4) : $@convention(method) (Int, Int, @thin Int.Type) -> Int // user: %15
  store %14 to [trivial] %3 : $*Int               // id: %15
  alloc_global @$s4main6secondSivp                // id: %16
  %17 = global_addr @$s4main6secondSivp : $*Int   // user: %29
  %18 = metatype $@thin Int.Type                  // user: %28
  %19 = integer_literal $Builtin.IntLiteral, 3    // user: %22
  %20 = metatype $@thin Int.Type                  // user: %22
  // function_ref Int.init(_builtinIntegerLiteral:)
  %21 = function_ref @$sSi22_builtinIntegerLiteralSiBI_tcfC : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int // user: %22
  %22 = apply %21(%19, %20) : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int // user: %28
  %23 = integer_literal $Builtin.IntLiteral, 4    // user: %26
  %24 = metatype $@thin Int.Type                  // user: %26
  // function_ref Int.init(_builtinIntegerLiteral:)
  %25 = function_ref @$sSi22_builtinIntegerLiteralSiBI_tcfC : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int // user: %26
  %26 = apply %25(%23, %24) : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int // user: %28
  // function_ref static Int.+ infix(_:_:)
  %27 = function_ref @$sSi1poiyS2i_SitFZ : $@convention(method) (Int, Int, @thin Int.Type) -> Int // user: %28
  %28 = apply %27(%22, %26, %18) : $@convention(method) (Int, Int, @thin Int.Type) -> Int // user: %29
  store %28 to [trivial] %17 : $*Int              // id: %29
  %30 = integer_literal $Builtin.Int32, 0         // user: %31
  %31 = struct $Int32 (%30 : $Builtin.Int32)      // user: %32
  return %31 : $Int32                             // id: %32
} // end sil function 'main'

// Int.init(_builtinIntegerLiteral:)
sil [transparent] [serialized] @$sSi22_builtinIntegerLiteralSiBI_tcfC : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int

// static Int.+ infix(_:_:)
sil [transparent] [serialized] @$sSi1poiyS2i_SitFZ : $@convention(method) (Int, Int, @thin Int.Type) -> Int



// Mappings from '#fileID' to '#filePath':
//   'main/SSA-test.swift' => 'SSA-test.swift'
```

## âœ… .rawsil íŒŒì¼ì¼ ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” SSA í˜•ì‹.

### 1. ë³€ìˆ˜ í• ë‹¹.

ê° ë³€ìˆ˜ëŠ” í•œ ë²ˆë§Œ í• ë‹¹ ë©ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ **`%3 = global_addr @$s4main5firstSivp : $*Int`** ì™€ ê°™ì€ êµ¬ë¬¸ì—ì„œ **`%3`** ì€ í•œ ë²ˆë§Œ í• ë‹¹ë©ë‹ˆë‹¤.

ì´í›„ í•´ë‹¹ ë³€ìˆ˜ëŠ” ë³€ê²½ë˜ì§€ ì•Šê³  ë‹¤ë¥¸ ë³€ìˆ˜ì— ëŒ€ì…ë˜ê±°ë‚˜ ì—°ì‚°ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

### 2. ì„ì‹œ ë³€ìˆ˜ ì‚¬ìš©.

ì—°ì‚° ê²°ê³¼ëŠ” ìƒˆë¡œìš´ ì„ì‹œ ë³€ìˆ˜ì— í• ë‹¹ë©ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ **`%14 = apply %13(%8, %12, %4)`** ì—ì„œ **`%14`** ëŠ” ìƒˆë¡œìš´ ë³€ìˆ˜ì´ë©°, ì´ ë³€ìˆ˜ëŠ” ì´í›„ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### 3. í•¨ìˆ˜ í˜¸ì¶œ ê²°ê³¼ í• ë‹¹.

í•¨ìˆ˜ í˜¸ì¶œì˜ ê²°ê³¼ë„ ìƒˆë¡œìš´ ë³€ìˆ˜ì— í• ë‹¹ë©ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, `%8 = apply %7(%5, %6)`ì—ì„œ `%8`ì€ í•¨ìˆ˜ í˜¸ì¶œì˜ ê²°ê³¼ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

### 4. íë¦„ ì œì–´.

ê° ë³€ìˆ˜ì˜ í• ë‹¹ì€ ì½”ë“œ íë¦„ì— ë”°ë¼ ìˆœì°¨ì ìœ¼ë¡œ ì´ë£¨ì–´ ì§‘ë‹ˆë‹¤.

---

# ğŸ“ ê²°ë¡ .

"SSAì˜ ëª¨ë“  íŠ¹ì„±ì´ë‚˜ ë³µì¡í•œ ì‚¬ìš© ì‚¬ë¡€ê°€ ëª¨ë‘ ë‚˜íƒ€ë‚˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤."

**"ì¦‰, SSA í˜•ì‹ì„ ëœ ì—„ê²©í•˜ê²Œ ì ìš©í•œ ê²ƒì…ë‹ˆë‹¤."**

ë”°ë¼ì„œ ì œê°€ ì£¼ì¥í•œ ì˜ê²¬ **Apple ë ˆí¬ì§€í† ë¦¬ ë‚´ë¶€ Swift docsì˜ ë‚´ìš©ê³¼ëŠ” ë‹¤ë¥¸ ë‚´ìš©**ì€ **"ì£¼ì¥ê³¼ ê·¼ê±°ê°€ ì•Œë§ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."**

--- 

### ì°¸ê³  ìë£Œ ğŸ“š

- [Swift Repo Docs - SILGen](https://github.com/apple/swift/blob/main/docs/SIL.rst#silgen)
