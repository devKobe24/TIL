# iOS에서의 메모리 구조.(1) - Stack

iOS에서의 메모리 구조는 주로 다음과 같은 영역으로 구성되어 있습니다.

# 1️⃣ Stack(스택).

iOS에서 **Stack(스택)** 은 프로그램의 **함수 호출**과 관련된 메모리 영역입니다.
**Stack(스택)** 은 함수의 실행과 관련된 지역 변수, 매개변수, 반환 주소 등을 저장하는 데 사용됩니다.

# 2️⃣ Stack(스택)에 저장되는 정보들.

**Stack(스택)** 은 프로그램에서 함수 호출과 관련된 주요 데이터를 저장하는 메모리 영역입니다.

**Stack(스택)** 에서 관리되는 핵심 항목으로는 **지역 변수**, **매개변수**, **반환 주소**가 있습니다.

이 외에도 **Stack(스택)** 은 함수의 실행에 필요한 추가적인 정보를 저장할 수 있습니다.

## ✅ Stack에서 관리되는 핵심 항목.

**스택(Stack)** 은 프로그램에서 함수 호출과 관련된 주요 데이터를 저장하는 메모리 영역입니다.
스택에서 관리되는 핵심 항목으로는 지역 변수, 매개변수, 반환 주소가 있습니다.

### 1. 지역 변수(Local Variables).
- 지역 변수는 함수 내에서 선언되고 사용되는 변수들입니다.
- 이들은 함수가 호출될 때 생성되고, 함수가 종료될 때 스택에서 제거됩니다.
- 지역 변수는 해당 함수의 실행 컨텍스트 내에서만 존재하며, 함수 외부에서는 접근할 수 없습니다.
- 지역 변수의 값은 함수가 실행되는 동안 유지되며, 함수가 종료되면 해당 값은 사라집니다.

### 2. 매개변수(Parameters).
- 매개변수는 함수에 전달되는 입력 값입니다.
- 함수가 호출될 때, 매개변수는 함수를 호출하는 쪽에서 제공된 인자(argument)와 함께 스택에 저장됩니다.
- 매개변수를 통해 함수는 외부로부터 데이터를 받아들여 처리할 수 있습니다.
- 매개변수는 함수 내부에서 지역 변수처럼 사용될 수 있습니다.

### 3. 반환 주소(Return Address).
- 반환 주소는 함수가 처리를 마치고 제어를 반환할 위치를 나타냅니다.
- 함수가 호출될 때, 함수를 호출한 지점의 다음 명령어 주소가 스택에 저장됩니다. 이 주소는 함수가 모든 작업을 완료하고 종료될 때 사용됩니다.
- 함수의 실행이 끝나면, 이 반환 주소를 사용하여 프로그램의 흐름을 함수를 호출했던 지점으로 다시 돌려보냅니다.

## 🙌 Stack에서 관리되는 핵심 항목 마무리.

스택의 이러한 특성은 함수의 독립적인 실행을 가능하게 하며, 함수 호출의 깊이에 관계없이 각 함수가 자신만의 독립된 실행 공간을 가질 수 있도록 합니다.

이는 프로그램의 구조를 명확하게 하고, 데이터의 격리와 관리를 용이하게 만들어 프로그램의 신뢰성과 유지 보수성을 향상시킵니다.

## ✅ Stack에서 저장하는 함수 실행에 필요한 추가적인 정보.

함수의 실행에 필요한 추가적인 정보는 **스택(Stack)** 에서 관리되며, 이러한 정보는 주로 함수의 복잡한 연산과 실행 흐름 제어에 필요합니다.
이러한 정보에는 다음과 같은 항목들이 포함될 수 있습니다.

### 1. 임시 값(Temporary Values).

- 임시 값은 함수 내에서의 중간 계산 결과나 임시적으로 필요한 데이터를 저장합니다.
- 복잡한 연산을 수행하는 동안에 생성되는 중간 값들이나 조건문, 반복문 내에서 사용되는 임시 변수들이 여기에 해당합니다.
- 이러한 값들은 함수 실행 중에만 잠시 사용되며, 함수가 종료되면 필요 없어집니다.

### 2. 함수의 상태(Function State).

- 함수의 상태는 함수의 현재 실행 상태를 나타내는 정보입니다.
- 함수 내에서의 변수 상태, 현재 실행 중인 명령어의 위치, 조건문이나 반복문 등의 제어 흐름 정보가 포함될 수 있습니다.
- 이 정보는 함수가 중단되었다가 다시 시작할 때 이전 상태를 복원하는 데 사용될 수 있습니다.

### 3. 레지스터의 백업(Register Backups).

- 함수가 실행되면서 필요로 하는 CPU 레지스터의 값들이 스택에 임시로 저장될 수 있습니다.
- 이는 함수가 레지스터를 사용하기 전에 원래 값들을 백업하여, 함수 실행이 완료된 후 원래 상태로 복원할 수 있도록 합니다.
- 이를 통해 함수 간의 레지스터 사용 충돌을 방지하고, 프로그램의 안정성을 보장합니다.

### 4. 기타 제어 정보(Other Control Information).

- 함수의 실행과 관련된 추가적인 제어 정보가 저장될 수 있습니다.
- 이에는 함수 호출 계층 정보, 예외 처리를 위한 정보, 다른 함수로의 점프 정보 등이 포함될 수 있습니다.
- 이러한 정보는 프로그램의 흐름을 제어하고, 복잡한 연산을 수행하는 데 중요한 역할을 합니다.

## 🙌 Stack에서 저장하는 함수 실행에 필요한 추가적인 정보 마무리.

스택은 이러한 다양한 정보를 저장함으로써 함수의 복잡한 실행을 관리하고, 프로그램의 제어 흐름을 정확하게 유지하는 데 필수적인 역할을 합니다.

이는 프로그램이 예측 가능하고 안정적으로 동작하도록 하는 데 중요한 기여를 합니다.

## ✅ 제어🤔?

**"제어"** 라는 용어는 프로그래밍에서 **실행 흐름(Control flow)** 또는 **프로그램의 제어 흐름** 을 의미합니다.

프로그램에ㅔ서 **"제어를 반환한다"** 는 것은 현재 실행 중인 함수나 루틴이 작업을 완료하고, 실행 흐름을 호출한 함수나 이전의 실행 지점으로 돌려보낸다는 의미 입니다.

반환 주소(return address)의 컨텍스트에서의 **"제어"** 의 의미는 다음과 같습니다.

### 1. 실행 흐름의 이동.

프로그램이 특정 함수를 호출할 때, 실행 흐름은 그 함수로 이동합니다. 이때 "제어"는 해당 함수로 넘어갑니다.

### 2. 작업 완료 후 복귀.

함수가 자신의 작업을 마치면, 실행 흐름은 원래 호출했던 지점으로 돌아가야 합니다.
이 과정에서 "제어"는 다시 원래 함수나 프로그램의 이전 부분으로 반환됩니다.

### 3. 반환 주소의 역할.

스택에 저장된 반환 주소는 함수가 종료될 때 프로그램이 다음에 실행해야 할 코드의 위치를 가리킵니다.
함수가 끝나면 이 주소를 참조하여 "제어"를 원래의 호출 지점으로 다시 돌려보냅니다.

## 🙌 제어 마무리.

간단히 말해, "제어"는 프로그램이 어느 부분의 코드를 현재 실행하고 있는지를 나타내는 개념이며, 함수 호출과 반환 과정에서 중요한 역할을 합니다. 프로그램의 제어 흐름을 관리하는 것은 프로그램이 정상적으로 동작하고 예상대로 실행되도록 하는 데 필수적입니다.

## ✅ 명령어 주소(Instruction address)🤔?

**명령어 주소(Instruction address** 는 프로그램의 메모리에서 특정 명령어나 코드 라인이 위치한 주소를 나타냅니다.

이 개념은 프로그램의 실행 흐름과 밀접하게 관련되어 있으며, 프로그램의 어떤 부분이 현재 실행되고 있는지를 정확히 지시하는 데 사용됩니다.

반환 주소의 컨텍스트에서 **"명령어 주소"** 의 의미는 다음과 같습니다.

### 1. 프로그램 카운터.

프로그램 실행 중, **CPU**는 **프로그램 카운터(Program Counter)** 또는 **명령어 포인터(Instruction Pointer)** 라는 레지스터를 사용해 현재 실행 중인 코드의 **메모리 주소를 추적**합니다.

**이 주소**는 현재 실행 중인 명령어의 위치를 나타냅니다.

### 2. 함수 호출 시.

**함수가 호출될 때**, **프로그램의 흐름**은 해당 함수의 **시작 지점**으로 이동합니다.

이때, 함수를 호출한 원래 지점의 **"다음 명령어 주소"** 는 **스택(Stack)** 에 저장됩니다.

이 주소는 함수가 완료되고 제어가 들어갈 위치를 나타내는 데 사용됩니다.

### 3. 함수 종료 후.

**함수의 작업이 완료**되면, 저장된 **반환 주소를 참조**하여 프로그램의 흐름을 원해 함수가 호출되었던 지점의 다음 명령어로 돌려보냅니다.

이를 통해 프로그램은 연속적으로 실행을 이어갈 수 있습니다.

## 🙌 명령어 주소(Instruction address) 마무리.

간단히 말해, **"명령어 주소"** 는 프로그램 내 **특정 코드의 위치를 가리키는 메모리 주소**입니다.
함수 호출 과정에서 이 주소는 중요한 역할을 하며, 프로그램이 정상적인 순서대로 실행될 수 있도록 도와줍니다.
